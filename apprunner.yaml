version: 1.0
runtime: nodejs18
build:
  commands:
    pre-build:
      - echo "Installing dependencies including devDependencies..."
      - NPM_CONFIG_PRODUCTION=false npm ci
      - echo "Dependencies installed successfully"
    build:
      - echo "Building application with strict error checking..."
      - npm run build
    post-build:
      - echo "Verifying build artifacts..."
      - test -d dist && test -f dist/index.js
      - echo "Build completed successfully - ready for deployment"
  env:
    - name: NODE_ENV
      value: production
run:
  runtime-version: 18
  command: npm start
  network:
    port: 5000
    env: PORT
  env:
    - name: NODE_ENV
      value: production
    - name: PORT
      value: "5000"
    # These environment variables will be configured in AWS App Runner console
    # or through AWS Systems Manager Parameter Store
    # - name: DATABASE_URL
    #   value: <configured in AWS>
    # - name: OPENAI_API_KEY
    #   value: <configured in AWS>
    # - name: STRIPE_SECRET_KEY
    #   value: <configured in AWS>
    # - name: STRIPE_WEBHOOK_SECRET
    #   value: <configured in AWS>
    # - name: VITE_STRIPE_PUBLISHABLE_KEY
    #   value: <configured in AWS>
    # - name: VITE_GOOGLE_MAPS_API_KEY
    #   value: <configured in AWS>
  secrets:
    # Reference secrets from AWS Systems Manager Parameter Store or Secrets Manager
    # Example:
    # - name: DATABASE_URL
    #   value-from: arn:aws:secretsmanager:us-east-1:123456789012:secret:database-url
    # - name: OPENAI_API_KEY
    #   value-from: arn:aws:secretsmanager:us-east-1:123456789012:secret:openai-api-key
    # - name: STRIPE_SECRET_KEY
    #   value-from: arn:aws:secretsmanager:us-east-1:123456789012:secret:stripe-secret-key